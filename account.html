<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Eldercart - Account</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f7efe3;font-weight:bold}
.navbar{display:flex;justify-content:space-between;align-items:center;background:#8a4616;padding:12px 20px}
.navbar img{height:90px}
.nav-right a{background:white;padding:10px 18px;color:#8a4616;text-decoration:none;border-radius:6px}
.container{width:90%;max-width:900px;margin:22px auto}
.box{background:#fff;border:3px solid #8a4616;border-radius:12px;padding:18px;margin-bottom:18px}
label{display:block;margin-top:8px;font-weight:700}
input,select{width:100%;box-sizing:border-box;padding:8px;margin-top:6px;font-size:16px}
.row{display:flex;gap:12px}
.col{flex:1}
.btn{padding:12px 16px;background:#8a4616;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:16px}
.pay-toggle{display:flex;gap:8px;margin-top:8px}
.pay-toggle input{display:none}
.pay-toggle label{padding:10px 14px;border-radius:8px;border:2px solid #dcdcdc;cursor:pointer;background:white;color:#333;flex:1;text-align:center}
.pay-toggle input:checked + label{background:linear-gradient(135deg,#8a4616,#6b2f12);color:white;border-color:#8a4616;box-shadow:0 8px 24px rgba(138,70,22,0.16)}
.muted{color:#666;font-size:14px}
.order-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);opacity:0;pointer-events:none;transition:opacity 240ms ease;z-index:9999}
.order-overlay.visible{opacity:1;pointer-events:auto}
.order-popup{border:4px solid #8a4616;background:#fff;border-radius:12px;padding:22px 20px;width:360px;box-shadow:0 18px 40px rgba(0,0,0,0.24);text-align:center}
</style>
</head>
<body>
  <div class="navbar">
    <a href="index.html"><img src="logo.png"></a>
    <div class="nav-right">
      <a href="index.html">HOME</a>
      <a href="products.html">PRODUCTS</a>
      <a href="cart.html">CART</a>
    </div>
  </div>

  <div class="container">
    <div class="box">
      <h2>Your Account</h2>
      <div id="notSigned" style="display:none;">
        <p class="muted">You are not signed in. Please <a href="signup.html">Sign up</a> or <a href="login.html">Log in</a>.</p>
      </div>
      <div id="profileArea" style="display:none;">
        <label>Full name</label>
        <input id="fullname" placeholder="Full name">
        <label>Email</label>
        <input id="email" placeholder="Email">
        <label>Age group</label>
        <select id="ageSelect"><option value="">Select</option><option>60+</option><option>70+</option><option>80+</option></select>
        <div style="margin-top:12px;display:flex;gap:12px;align-items:center">
          <button id="saveBtn" class="btn">Save Profile</button>
          <div id="balanceBox" style="margin-left:auto;align-self:center">Balance: ₹<span id="balanceVal">0.00</span></div>
        </div>
      </div>
    </div>

    <div class="box">
      <h3>Add Elder Money</h3>
      <div id="addArea" style="display:none;">
        <label>Method</label>
        <div class="pay-toggle">
          <input type="radio" name="payMethod" id="methodUpi" value="upi" checked>
          <label for="methodUpi">UPI</label>
          <input type="radio" name="payMethod" id="methodCard" value="card">
          <label for="methodCard">Credit Card</label>
        </div>

        <div id="upiBox">
          <label>UPI ID</label>
          <input id="upiId" placeholder="your@upi">
        </div>

        <div id="cardBox" style="display:none;">
          <label>Card Number</label>
          <input id="cardNum" placeholder="1234 5678 9012 3456" inputmode="numeric" maxlength="19">
          <label>Expiry MM/YY</label>
          <input id="cardExp" placeholder="MM/YY" maxlength="5" inputmode="numeric">
          <label>CVV</label>
          <input id="cardCvv" placeholder="CVV" inputmode="numeric" maxlength="3">
        </div>

        <label>Amount (₹)</label>
        <input id="addAmount" type="number" min="1" placeholder="Amount to add">
        <hr style="margin:14px 0">
        <h4>Refund Elder Money</h4>
        <label>Refund Amount (₹)</label>
        <input id="refundAmount" type="number" min="1" placeholder="Amount to refund">

        <label style="margin-top:10px;">Refund Method</label>
        <div class="pay-toggle">
          <input type="radio" name="refundMethod" id="refundUpiMethod" value="upi" checked>
          <label for="refundUpiMethod">UPI</label>
          <input type="radio" name="refundMethod" id="refundCardMethod" value="card">
          <label for="refundCardMethod">Credit Card</label>
        </div>

        <div id="refundUpiBox" style="margin-top:8px;">
          <label>Refund UPI ID</label>
          <input id="refundUpiId" placeholder="your@upi">
        </div>

        <div id="refundCardBox" style="display:none;margin-top:8px;">
          <label>Refund Card Number</label>
          <input id="refundCardNum" placeholder="1234 5678 9012 3456" inputmode="numeric" maxlength="19">
          <label>Expiry MM/YY</label>
          <input id="refundCardExp" placeholder="MM/YY" maxlength="5" inputmode="numeric">
          <label>CVV</label>
          <input id="refundCardCvv" placeholder="CVV" inputmode="numeric" maxlength="3">
        </div>

        <div style="margin-top:12px;display:flex;gap:12px;">
          <button id="refundBtn" class="btn" style="background:#c0392b">Refund</button>
          <div style="flex:1"></div>
        </div>
        <div style="margin-top:12px;display:flex;gap:12px;">
          <button id="buyBtn" class="btn">Buy / Add Money</button>
          
        </div>
      </div>
    </div>
  </div>

  <div id="txOverlay" class="order-overlay" aria-hidden="true" style="display:none">
    <div class="order-popup" role="dialog" aria-modal="true">
      <h3 id="txTitle">Processing...</h3>
      <div id="txMsg" style="margin-top:8px;color:#333">Please wait</div>
    </div>
  </div>

<script>
  function $(id){return document.getElementById(id)}
  let user = JSON.parse(localStorage.getItem('elderUser'));
  function showOverlay(title,msg){
    const ov = $('txOverlay');
    $('txTitle').innerText = title; $('txMsg').innerText = msg;
    ov.style.display = 'flex'; void ov.offsetWidth; ov.classList.add('visible'); ov.setAttribute('aria-hidden','false');
  }
  function hideOverlay(){const ov=$('txOverlay'); ov.classList.remove('visible'); ov.setAttribute('aria-hidden','true'); setTimeout(()=>ov.style.display='none',260)}

  function refreshProfile(){
    user = JSON.parse(localStorage.getItem('elderUser'));
    if(!user){ $('notSigned').style.display='block'; $('profileArea').style.display='none'; $('addArea').style.display='none'; return; }
    $('notSigned').style.display='none'; $('profileArea').style.display='block'; $('addArea').style.display='block';
    $('fullname').value = user.fullname || '';
    $('email').value = user.email || '';
    $('ageSelect').value = user.age || '';
    const bal = Number(user.elderMoney || 0).toFixed(2);
    $('balanceVal').innerText = bal;
  }

  refreshProfile();

  // toggle payment input boxes
  document.querySelectorAll('input[name="payMethod"]').forEach(r=>r.addEventListener('change',function(){
    if(this.value==='upi'){ $('upiBox').style.display='block'; $('cardBox').style.display='none'; }
    else { $('upiBox').style.display='none'; $('cardBox').style.display='block'; }
  }));

  // toggle refund input boxes
  document.querySelectorAll('input[name="refundMethod"]').forEach(r=>r.addEventListener('change',function(){
    if(this.value==='upi'){ $('refundUpiBox').style.display='block'; $('refundCardBox').style.display='none'; }
    else { $('refundUpiBox').style.display='none'; $('refundCardBox').style.display='block'; }
  }));

  $('saveBtn').addEventListener('click',function(){
    if(!user) user = {};
    user.fullname = $('fullname').value.trim();
    user.email = $('email').value.trim();
    user.age = $('ageSelect').value;
    localStorage.setItem('elderUser', JSON.stringify(user));
    refreshProfile();
    alert('Profile saved');
  });

  $('buyBtn').addEventListener('click',function(){
    const amount = Number($('addAmount').value || 0);
    if(amount <= 0){ alert('Enter a valid amount'); return; }
    const method = document.querySelector('input[name="payMethod"]:checked').value;
    if(method==='card'){
      const cnum=$('cardNum').value.replace(/\s+/g,'').trim(), cvv=$('cardCvv').value.trim(), exp=$('cardExp').value.trim();
      if(!/^\d{16}$/.test(cnum)){ alert('Card number must be exactly 16 digits'); return; }
      if(!/^\d{3}$/.test(cvv)){ alert('CVV must be exactly 3 digits'); return; }
      if(!/^\d{2}\/\d{2}$/.test(exp)){ alert('Expiry must be in MM/YY format'); return; }
    }
    if(method==='upi'){ const upi=$('upiId').value.trim(); if(!upi || !upi.endsWith('@upi')){ alert('UPI id must end with @upi'); return; } }

    // simulate 5s transaction then update balance and show popup
    $('buyBtn').disabled = true; $('buyBtn').innerText = 'Processing...';
    showOverlay('Processing Transaction','Please wait 5 seconds...');
    let t=5; const iv=setInterval(()=>{ t--; if(t<=0){ clearInterval(iv); hideOverlay();
        // update balance
        user = JSON.parse(localStorage.getItem('elderUser')) || {};
        user.elderMoney = Number(user.elderMoney || 0) + amount;
        localStorage.setItem('elderUser', JSON.stringify(user));
        refreshProfile();
        // success popup
        showOverlay('Transaction done successfully','Funds have been added to your Elder Money.');
        setTimeout(()=>{ hideOverlay(); $('buyBtn').disabled=false; $('buyBtn').innerText='Buy / Add Money'; }, 1800);
    }},1000);
  });

  // Refund handler
  $('refundBtn').addEventListener('click', function(){
    const amt = Number($('refundAmount').value || 0);
    if(amt <= 0){ alert('Enter a valid refund amount'); return; }
    user = JSON.parse(localStorage.getItem('elderUser')) || {};
    const bal = Number(user.elderMoney || 0);
    if(amt > bal){ showOverlay('Insufficient Money','You do not have enough Elder Money to refund.'); setTimeout(()=>hideOverlay(),1800); return; }

    const method = document.querySelector('input[name="refundMethod"]:checked')?.value || 'upi';
    // validate refund destination
    if(method === 'upi'){
      const rupi = $('refundUpiId').value.trim();
      if(!rupi || !rupi.endsWith('@upi')){ alert('Refund UPI id must end with @upi'); return; }
    } else {
      const rcnum = $('refundCardNum').value.replace(/\s+/g,'').trim();
      const rcvv = $('refundCardCvv').value.trim();
      const rexp = $('refundCardExp').value.trim();
      if(!/^\d{16}$/.test(rcnum)){ alert('Refund card number must be exactly 16 digits'); return; }
      if(!/^\d{3}$/.test(rcvv)){ alert('Refund CVV must be exactly 3 digits'); return; }
      if(!/^\d{2}\/\d{2}$/.test(rexp)){ alert('Refund card expiry must be in MM/YY format'); return; }
    }

    // simulate processing and then perform refund deduction
    $('refundBtn').disabled = true; $('refundBtn').innerText = 'Processing...';
    showOverlay('Processing Refund','Please wait...');
    let t = 3; const iv = setInterval(()=>{ t--; if(t<=0){ clearInterval(iv); hideOverlay();
        // deduct balance and persist
        user = JSON.parse(localStorage.getItem('elderUser')) || {};
        const currentBal = Number(user.elderMoney || 0);
        user.elderMoney = (currentBal - amt).toFixed(2);
        localStorage.setItem('elderUser', JSON.stringify(user));
        refreshProfile();
        // success message tailored to method
        if(method === 'upi'){
          const rupi = $('refundUpiId').value.trim();
          showOverlay('Successfully Refunded', `₹${amt.toFixed(2)} refunded to ${rupi}`);
        } else {
          const rcnum = $('refundCardNum').value.replace(/\s+/g,'').trim();
          const last4 = rcnum.slice(-4);
          showOverlay('Successfully Refunded', `₹${amt.toFixed(2)} refunded to Card ending ${last4}`);
        }
        setTimeout(()=>{ hideOverlay(); $('refundBtn').disabled=false; $('refundBtn').innerText='Refund'; }, 1800);
    }},1000);
  });

  $('cancelAdd').addEventListener('click', function(){ $('addAmount').value=''; $('upiId').value=''; $('cardNum').value=''; $('cardExp').value=''; $('cardCvv').value=''; });
</script>
</script>
<script src="snow.js"></script>
</body>
</html>
